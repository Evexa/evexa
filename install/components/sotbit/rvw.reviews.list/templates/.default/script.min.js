SA_ReviewsList={init:function(e){this.signedParameters=e.signedParameters,e.arFile&&(this.arFile=JSON.parse(e.arFile)),this.blockParent=document.querySelector(".reviews__content_wrapper"),this.blockParent&&(this.btnComplaints=this.blockParent.querySelectorAll('[data-type="complaints"]'),this.btnLike=this.blockParent.querySelectorAll('[data-type="like"]'),this.btnCopy=this.blockParent.querySelectorAll('[data-type="copy"]'),this.btnEdit=this.blockParent.querySelectorAll('[data-type="edit"]'),this.btnMore=document.querySelector(".more-reviews button"),this.initSlider(),this.btnComplaints&&this.initEventComplaints(),this.btnLike&&this.initEventLike(),this.btnCopy&&this.initEventCopy(),this.btnMore&&this.initMore(),this.btnEdit&&this.initEventEdit())},initEventComplaints:function(){this.btnComplaints.forEach((e=>{e.addEventListener("click",(()=>{this.currentComplaintItem=e,SA_ReviewsAdd.showModalResult(BX.message("TITLE_MODAL_COMPLAINTS_SELECTION"),"selection")}))}))},initEventLike:function(){this.btnLike.forEach((e=>{e.addEventListener("click",(t=>{this.isNeedActiveLike=!0,e.closest(".content__reviews__item__control").querySelectorAll(".content__reviews__item__control__item").forEach((t=>{t.classList.contains("btn-reviews-small--active")&&t!=e&&(this.isNeedActiveLike=!1,this.elementRecalculationLike(t,!1),this.elementRecalculationLike(e))})),this.isNeedActiveLike&&this.elementRecalculationLike(e)}))}))},initEventCopy:function(){this.btnCopy.forEach((e=>{e.addEventListener("click",(()=>{const t=new URL(e.dataset.value,location.href);this.copy(t.href)}))}))},initEventEdit:function(){this.btnEdit.forEach((e=>{e.addEventListener("click",(()=>{const t=document.getElementById("review_add__modal"),i=t.querySelector('[name="ANONYMOUS"]');if(i&&BX.hide(i.closest(".control__item-filter--checkbox")),SA_ReviewsAdd.showRating(e.dataset.rating),SA_ReviewsAdd.setRatingValue(e.dataset.rating),this.arFile){const t=this.arFile[e.dataset.id];t&&Object.keys(t).forEach((e=>{SA_ReviewsAdd.dropzone.displayExistingFile({id:e,src:t[e].src,type:t[e].type,edit:t[e].edit},t[e].src),SA_ReviewsAdd.form.appendChild(SA_ReviewsAdd.hiddenInputs[e]=BX.create("input",{attrs:{type:"hidden",name:"MEDIA[]",value:e}}))}))}SA_ReviewsAdd.setRatingValue(e.dataset.rating),SA_ReviewsAdd.form.setAttribute("data-active","edit"),SA_ReviewsAdd.form.appendChild(SA_ReviewsAdd.hiddenInputs[e.dataset.id]=BX.create("input",{attrs:{type:"hidden",name:"ID",value:e.dataset.id}})),BX.Sotbit.Reviews.fixBodyScroll(),SA_ReviewsAdd.overlay||(SA_ReviewsAdd.overlay=BX.Sotbit.Reviews.showOverlay()),SA_ReviewsAdd.overlay.element.addEventListener("click",(()=>{BX.Sotbit.Reviews.hideElement(t,{callback:()=>{BX.Sotbit.Reviews.unfixBodyScroll()}}),SA_ReviewsAdd.overlay?.hide(),SA_ReviewsAdd.overlay=null}),{once:!0}),BX.Sotbit.Reviews.showElement(t),t.querySelector("#review-comment").value=e.closest(".reviews__content").querySelector(".content__reviews__item__body p").innerHTML.trim(),SA_ReviewsAdd.form.dataset.active}))}))},initMore:function(){this.btnMore.addEventListener("click",(()=>{let e=this.btnMore.value;e<=0?(this.btnMore.setAttribute("value","2"),e=2):this.btnMore.setAttribute("value",e=Number(e)+1),this.moreReviewsController(e)}))},editReviewsController:async function(e){BX.ajax.runComponentAction("sotbit:rvw.reviews.list","edit",{mode:"class",data:new FormData(e)}).then((()=>{BX.closeWait(),BX.Sotbit.Reviews.hideElement(SA_ReviewsAdd.mainModal,{callback:()=>{SA_ReviewsAdd.overlay?.hide()}}),BX.Sotbit.Reviews.unfixBodyScroll(),SA_ReviewsAdd.overlay?.hide(),SA_ReviewsAdd.overlay=null,SA_ReviewsAdd.showModalResult(BX.message("TITLE_MODAL_EDIT"),"success"),SA_ReviewsAdd.deleteFormField(),SA_Reviews.reloadList({})}),(e=>{BX.closeWait(),SA_ReviewsAdd.showModalResult(e.errors.map((e=>e.message)).join("\n"),"error")}))},moreReviewsController:async function(e){try{BX.showWait();const{data:t}=await BX.ajax.runComponentAction("sotbit:rvw.reviews","contentLoader",{mode:"class",signedParameters:this.signedParameters,data:{more:e}}),i=BX.processHTML(t.html,!1),s=(new DOMParser).parseFromString(i.HTML,"text/html").querySelector(".reviews__content_wrapper");s&&(this.blockParent.querySelector(".pagination-reviews-wrapper")?.remove(),this.blockParent.insertAdjacentHTML("beforeend",s.innerHTML),BX.ajax.processScripts(i.SCRIPT))}catch(e){console.error(e)}finally{BX.closeWait()}},copy:async function(e){if(navigator.clipboard)return await navigator.clipboard.writeText(e),void SA_ReviewsAdd.showModalResult(BX.message("TITLE_MODAL_COPY"),"success");try{this.fallbackCopyTextToClipboard(e)}catch(e){return console.error("Unable to copy text")}SA_ReviewsAdd.showModalResult(BX.message("TITLE_MODAL_COPY"),"success")},fallbackCopyTextToClipboard:function(e){const t=BX.create("input",{style:{position:"absolute",height:0},attrs:{value:e}});document.body.appendChild(t),t.select();const i=document.execCommand("copy");if(document.body.removeChild(t),!i)throw new Error("Unable to copy text")},elementRecalculationLike:function(e,t=!0){let i=e.querySelector("p"),s=i.innerHTML;if(itemNodeParent=i.closest(".content__reviews__item__control__item"),e.classList.contains("btn-reviews-small--active")){let n={};n[e.dataset.value.toUpperCase()]="N",n.REVIEW_ID=e.dataset.id,t?this.elementLikeController(n,e):(i.textContent="0"!=s?Number(s)-1==0?"0":Number(s)-1:"0",e.classList.remove("btn-reviews-small--active"))}else{let n={};n[e.dataset.value.toUpperCase()]="Y",n.REVIEW_ID=e.dataset.id,t?this.elementLikeController(n,e):(i.textContent="0"!=s?Number(s)+1:"1",e.classList.add("btn-reviews-small--active"))}},elementLikeController:async function(e,t){BX.ajax.runComponentAction("sotbit:rvw.reviews.list","like",{mode:"class",data:{data:e}}).then((e=>{1!=e.data&&this.elementRecalculationLike(t,!1)}),(e=>{this.elementRecalculationLike(t,!1)}))},initSlider:function(){new Swiper(".swiper-reviews",{slidesPerView:7,spaceBetween:10,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})},elementComplaintController:async function(){const e=this.currentComplaintItem.dataset.id;if(e)try{const{data:t}=await BX.ajax.runComponentAction("sotbit:rvw.reviews.list","complaints",{mode:"class",data:{id:e}});"success"===t.status&&(SA_ReviewsAdd.closeModalResult(),SA_ReviewsAdd.showModalResult(t.message,t.status))}catch(e){SA_ReviewsAdd.closeModalResult(),SA_ReviewsAdd.showModalResult(e.errors.map((e=>e.message)).join("\n"),"error")}}};
//# sourceMappingURL=script.min.js.map
