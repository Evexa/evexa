{"version":3,"file":"script.min.js","names":["SA_QuestionsList","init","params","this","signedParameters","blockParent","document","querySelector","btnLike","querySelectorAll","btnEdit","btnMore","initEventLike","initMore","initEventEdit","forEach","itemLike","addEventListener","e","isNeedActiveLike","closest","item","classList","contains","elementRecalculationLike","itemEdit","SA_QuestionsAdd","form","value","innerHTML","trim","appendChild","SA_ReviewsAdd","hiddenInputs","dataset","id","BX","create","attrs","type","name","focus","setAttribute","Number","moreQuestionsController","editQuestionsController","async","ajax","runComponentAction","mode","data","FormData","then","showModalResult","message","deleteFormField","SA_Questions","reloadList","error","closeWait","errors","map","join","showWait","more","processed","processHTML","html","content","DOMParser","parseFromString","HTML","remove","insertAdjacentHTML","processScripts","SCRIPT","console","elem","isController","valueNode","valueLike","itemNodeParent","field","toUpperCase","elementLikeController","textContent","add","response","hideOverlay","relativeElement","body","overlayElement","style","opacity","setTimeout","parseFloat","getComputedStyle","getPropertyValue"],"sources":["rvw.questions.list/templates/.default/script.js"],"mappings":"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","ignoreList":[],"sourcesContent":["SA_QuestionsList = {\n    init: function (params) {\n        this.signedParameters = params.signedParameters;\n\n        this.blockParent = document.querySelector('.reviews__content_wrapper');\n\n        if (this.blockParent) {\n            this.btnLike = this.blockParent.querySelectorAll('[data-type=\"like\"]');\n            this.btnEdit = this.blockParent.querySelectorAll('[data-type=\"edit\"]');\n            this.btnMore = document.querySelector('.more-reviews button');\n\n            if (this.btnLike) {\n                this.initEventLike();\n            }\n            if (this.btnMore) {\n                this.initMore();\n            }\n            if (this.btnEdit) {\n                this.initEventEdit();\n            }\n        }\n    },\n\n    initEventLike: function () {\n        this.btnLike.forEach(itemLike => {\n            itemLike.addEventListener('click', (e) => {\n                this.isNeedActiveLike = true;\n\n                itemLike.closest('.content__reviews__item__control').querySelectorAll('.content__reviews__item__control__item').forEach(item => {\n                    if (item.classList.contains('btn-reviews-small--active')) {\n                        if (item != itemLike) {\n                            this.isNeedActiveLike = false;\n                            this.elementRecalculationLike(item, false);\n                            this.elementRecalculationLike(itemLike);\n                        }\n                    }\n                });\n\n                if (this.isNeedActiveLike) {\n                    this.elementRecalculationLike(itemLike);\n                }\n            });\n        })\n    },\n\n    initEventEdit: function () {\n        this.btnEdit.forEach(itemEdit => {\n\n            itemEdit.addEventListener('click', () => {\n                SA_QuestionsAdd.form.querySelector('[name=\"QUESTION\"]').value = itemEdit.closest('.reviews__content').querySelector('.content__reviews__item__body p').innerHTML.trim();\n                SA_QuestionsAdd.form.appendChild(\n                    SA_ReviewsAdd.hiddenInputs[itemEdit.dataset.id] = BX.create('input', {\n                        attrs: {\n                            'type': 'hidden',\n                            'name': 'ID',\n                            'value': itemEdit.dataset.id\n                        }\n                    })\n                );\n                SA_QuestionsAdd.form.querySelector('[name=\"QUESTION\"]').focus();\n            });\n        })\n    },\n\n    initMore: function () {\n        this.btnMore.addEventListener('click', () => {\n            let value = this.btnMore.value;\n\n            if (value <= 0) {\n                this.btnMore.setAttribute('value', '2');\n                value = 2;\n            } else {\n                this.btnMore.setAttribute('value', (value = Number(value) + 1));\n            }\n\n            this.moreQuestionsController(value);\n        })\n    },\n\n    editQuestionsController: async function (form) {\n        BX.ajax.runComponentAction('sotbit:rvw.questions.list', 'edit', {\n            mode: 'class',\n            data: new FormData(form),\n        }).then(\n            () => {\n\n                SA_QuestionsAdd.showModalResult(BX.message('TITLE_MODAL_EDIT'), 'success');\n                SA_QuestionsAdd.deleteFormField()\n                SA_Questions.reloadList({});\n            },\n            (error) => {\n                BX.closeWait();\n                SA_QuestionsAdd.showModalResult(error.errors.map(item => item.message).join('\\n'), 'error')\n            }\n        );\n\n\n    },\n\n    moreQuestionsController: async function (value) {\n        try {\n            BX.showWait();\n            const {data} = await BX.ajax.runComponentAction('sotbit:rvw.questions', 'contentLoader', {\n                mode: 'class',\n                signedParameters: this.signedParameters,\n                data: {\n                    more: value\n                },\n            });\n\n            const processed = BX.processHTML(data.html, false),\n                html = new DOMParser().parseFromString(processed.HTML, \"text/html\"),\n                content = html.querySelector('.reviews__content_wrapper');\n\n            if (content) {\n                this.blockParent.querySelector('.pagination-reviews-wrapper')?.remove();\n                this.blockParent.insertAdjacentHTML('beforeend', content.innerHTML);\n                BX.ajax.processScripts(processed.SCRIPT);\n            }\n\n        } catch (e) {\n            console.error(e);\n        } finally {\n            BX.closeWait();\n        }\n    },\n\n    elementRecalculationLike: function (elem, isController = true) {\n\n        let valueNode = elem.querySelector('p');\n        let valueLike = valueNode.innerHTML;\n\n        itemNodeParent = valueNode.closest('.content__reviews__item__control__item');\n\n        if (!elem.classList.contains('btn-reviews-small--active')) {\n            let field = {};\n            field[elem.dataset.value.toUpperCase()] = 'Y';\n            field['QUESTION_ID'] = elem.dataset.id;\n\n\n            if (isController) {\n                this.elementLikeController(field, elem);\n            } else {\n\n                if (valueLike != '0') {\n                    valueNode.textContent = Number(valueLike) + 1;\n                } else {\n                    valueNode.textContent = '1';\n                }\n\n                elem.classList.add('btn-reviews-small--active');\n            }\n        } else {\n            let field = {};\n            field[elem.dataset.value.toUpperCase()] = 'N';\n            field['QUESTION_ID'] = elem.dataset.id;\n\n            if (isController) {\n                this.elementLikeController(field, elem);\n            } else {\n                if (valueLike != '0') {\n                    valueNode.textContent = (Number(valueLike) - 1) == 0 ? '0' : Number(valueLike) - 1;\n                } else {\n                    valueNode.textContent = '0';\n                }\n\n                elem.classList.remove('btn-reviews-small--active');\n            }\n        }\n    },\n\n    elementLikeController: async function (field, elem) {\n\n        BX.ajax.runComponentAction('sotbit:rvw.questions.list', 'like', {\n            mode: 'class',\n            data: {data: field},\n        }).then(\n            (response) => {\n                if (response.data != true) {\n                    this.elementRecalculationLike(elem, false);\n                }\n            },\n            (error) => {\n                this.elementRecalculationLike(elem, false);\n            }\n        );\n    },\n\n    hideOverlay: function (\n        mode = \"top\",\n        relativeElement = document.body\n    ) {\n        const overlayElement = relativeElement.querySelector(\".overlay\");\n\n        if (!overlayElement) {\n            return;\n        }\n\n        overlayElement.style.opacity = 0;\n        setTimeout(() => {\n            overlayElement.remove();\n        }, parseFloat(getComputedStyle(document.body).getPropertyValue(\"--transition\")) * 1000);\n    },\n};"]}