SA_ReviewsAdd={init:function(e){this.mainModal=document.getElementById("review_add__modal"),this.form=this.mainModal.querySelector("form"),this.form&&(this.btnSubmit=this.mainModal.querySelector('button[type="submit"]'),this.ratingNumber=e.ratingNumber,this.ratingButtons=this.form.querySelectorAll("button[data-rating]"),this.ratingDescriptions=this.form.querySelectorAll(".rating_description span[data-rating]"),this.ratingInput=this.form.querySelector('input[name="RATING"]'),this.hiddenInputs=[],this.fileUploadUrl=e.fileUploadUrl,this.imagesFolder=e.imagesFolder,this.canAddReview=e.canAddReview,this.canAddReviewError=e.canAddReviewError,this.isAuthUser=e.isAuthUser,this.isAnonymous=e.isAnonymous,this.isBuyProduct=e.isBuyProduct,this.canRepeat=!!e.canRepeat,this.modRepeat=e.modRepeat?e.modRepeat:-1,this.countRepeat=e.countRepeat?e.countRepeat:0,this.isTimeRepeat="Y"==e.isTimeRepeat,this.isModerate="Y"==e.isModerate,this.configFile=JSON.parse(e.configFile),this.signedParameters=e.signedParameters,this.counterImage=0,this.counterVideo=0,this.initModals(),this.dropzoneInit(),this.btnSubmit.addEventListener("click",this.sendReview.bind(this)),this.form.addEventListener("submit",this.sendReview.bind(this)),BX.onCustomEvent("sotbit:reviews.reviewsAddInit",[this]))},getParams:function(e){let t=new URL(document.location).searchParams,i={};for(var s of t.entries())i[s[0]]=s[1];return i},initModals:function(){document.addEventListener("click",(async e=>{const t=e.target.closest('[data-action="show-modal"]');if(t){const e=t.dataset.target;if(!e)return;const i=document.getElementById(e);if(!i)return;if(i.querySelector(".content__reviews__item__body--quote").classList.add("display-none-important"),i.querySelector('input[name="ID_QUOTE"]').value="",!1===this.canAddReview)return void this.showModalResult(this.canAddReviewError,"error");if(!1===this.canRepeat)return void this.showModalResult(BX.message("repeat_message"),"error");!window.SimpleBar&&await BX.loadExt("sotbit.b2c.simplebar"),BX.Sotbit.Reviews.showElement(i),BX.Sotbit.Reviews.fixBodyScroll(),t.dataset.id?(i.querySelector(".review_add__title").innerHTML=BX.message("title_quite"),i.querySelector(".content__reviews__item__body--quote").classList.remove("display-none-important"),i.querySelector('input[name="ID_QUOTE"]').value=t.closest(".reviews__content").querySelector(".content__reviews__item__body p").innerHTML,i.querySelector(".reviews--quote p").innerHTML=t.closest(".reviews__content").querySelector(".content__reviews__item__body p").innerHTML,i.querySelector(".reviews--quote p").setAttribute("title",i.querySelector(".reviews--quote p").innerHTML)):i.querySelector(".review_add__title").innerHTML=BX.message("title_origin"),"policy_modal"!==t.dataset.target&&(this.overlay||(this.overlay=BX.Sotbit.Reviews.showOverlay()),BX.Sotbit.Reviews.fixBodyScroll());const s=i.querySelector('#review_add__modal input[type="checkbox"]'),r=this.form.querySelector('input[name="ANONYMOUS"]');"Y"===this.isAnonymous&&s&&s.addEventListener("change",(()=>{r.value=s.checked?"Y":"N"})),this.overlay.element.addEventListener("click",(()=>{BX.Sotbit.Reviews.hideElement(i,{callback:()=>{i===this.mainModal&&BX.Sotbit.Reviews.unfixBodyScroll()}}),this.overlay?.hide(),this.overlay=null,this.deleteFormField(i)}),{once:!0})}const i=e.target.closest('[data-action="close-modal"]');if(i){const e=i.closest("#review_add__modal");e&&BX.Sotbit.Reviews.hideElement(e,{callback:()=>{this.overlay?.hide(),this.overlay=null,BX.Sotbit.Reviews.unfixBodyScroll(),this.deleteFormField(e)}})}})),this.setRatingValue(this.ratingNumber),this.showRating(this.ratingNumber),this.initStarRatingEvents()},initStarRatingEvents:function(){this.ratingButtons.forEach((e=>e.addEventListener("click",(()=>{const t=e.dataset.rating;this.setRatingValue(t),this.showRating(t)})))),this.ratingButtons.forEach((e=>e.addEventListener("mouseover",(()=>{this.showRating(e.dataset.rating)})))),this.ratingButtons.forEach((e=>e.addEventListener("mouseout",(()=>{this.showRating(this.ratingInput.value)}))))},setRatingValue:function(e){this.ratingInput.value=e},showRating:function(e){this.ratingButtons.forEach((t=>{const i=t.querySelector(".review_add__star-icon--filled");t.dataset.rating>e?i.style.opacity=0:i.style.opacity=1}))},counterFile:function(e){let t=this.checkMimeType(e);return"image"==t&&++this.counterImage,"video"==t&&++this.counterVideo,t},counterFileMinus:function(e){let t=this.checkMimeType(e);return"image"==t&&--this.counterImage,"video"==t&&--this.counterVideo,t},checkMimeType:function(e){return this.isImage(e)?"image":this.isVideo(e)?"video":"error"},isImage:function(e){return arrayOfStrings=e.split(";"),strings=arrayOfStrings[0].trim(),strings.match("^image")},isVideo:function(e){return arrayOfStrings=e.split(";"),strings=arrayOfStrings[0].trim(),strings.match("^video")},bytesToSize:function(e,t=0){return 0===e?"0":Math.floor(Math.log(e)/Math.log(1024))},dropzoneInit:function(){if("NO"==this.configFile.REVIEWS_UPLOAD_FILE||!this.configFile.REVIEWS_UPLOAD_FILE)return;let e=0,t=0,i=".jpg, .gif, .bmp, .png, .jpeg, .webp, .mp4, .webm";"IMAGE"==this.configFile.REVIEWS_UPLOAD_FILE&&(i=".jpg, .gif, .bmp, .png, .jpeg, .webp",e=Number(this.configFile.REVIEWS_MAX_COUNT_IMAGES),t=Number(this.configFile.REVIEWS_MAX_IMAGE_SIZE)),"IMAGE_VIDEO"==this.configFile.REVIEWS_UPLOAD_FILE&&(i=".jpg, .gif, .bmp, .png, .jpeg, .webp, .mp4, .webm",e=Number(this.configFile.REVIEWS_MAX_COUNT_VIDEO)+Number(this.configFile.REVIEWS_MAX_COUNT_IMAGES),t=Number(this.configFile.REVIEWS_MAX_VIDEO_SIZE)),this.mainModal.querySelector("#dropzone_media")&&(this.dropzone=new Dropzone(this.mainModal.querySelector("#dropzone_media"),{previewTemplate:'<div class="dz-file-preview dz-preview"> <div class="dz-image"><img data-dz-thumbnail=""></div> <div class="dz-details"><div class="dz-filename"><span data-dz-name=""></span></div> </div> <div class="dz-progress"> <span class="dz-upload" data-dz-uploadprogress=""></span> </div> <div class="dz-error-message"><span data-dz-errormessage=""></span></div> <div class="dz-success-mark"> <svg width="54" height="54" fill="#fff"><path d="m10.207 29.793 4.086-4.086a1 1 0 0 1 1.414 0l5.586 5.586a1 1 0 0 0 1.414 0l15.586-15.586a1 1 0 0 1 1.414 0l4.086 4.086a1 1 0 0 1 0 1.414L22.707 42.293a1 1 0 0 1-1.414 0L10.207 31.207a1 1 0 0 1 0-1.414Z"/></svg> </div> <div class="dz-error-mark"> <svg width="54" height="54" fill="#fff"><path d="m26.293 20.293-7.086-7.086a1 1 0 0 0-1.414 0l-4.586 4.586a1 1 0 0 0 0 1.414l7.086 7.086a1 1 0 0 1 0 1.414l-7.086 7.086a1 1 0 0 0 0 1.414l4.586 4.586a1 1 0 0 0 1.414 0l7.086-7.086a1 1 0 0 1 1.414 0l7.086 7.086a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7.086-7.086a1 1 0 0 1 0-1.414l7.086-7.086a1 1 0 0 0 0-1.414l-4.586-4.586a1 1 0 0 0-1.414 0l-7.086 7.086a1 1 0 0 1-1.414 0Z"/></svg> </div> </div>',url:this.fileUploadUrl,parallelUploads:100,maxFiles:100,maxFilesize:t,paramName:"FILES_MEDIA",acceptedFiles:i,dictDefaultMessage:BX.message("dropzone_message"),dictRemoveFile:BX.message("dropzone_delete"),addRemoveLinks:!0,dictMaxFilesExceeded:BX.message("dropzone_error_max_files"),dictCancelUpload:BX.message("dropzone_delete"),dictUploadCanceled:BX.message("dropzone_cancel"),dictFileTooBig:BX.message("dropzone_file_too_big"),dictInvalidFileType:BX.message("error_file_type"),thumbnailWidth:90,thumbnailHeight:90}),this.dropzone.on("maxfilesexceeded",(()=>BX.Sotbit.Reviews.showMessage(BX.message("dropzone_error_max_files"),{icon:"error"}))),this.dropzone.previewsContainer.prepend(BX.create("button",{props:{className:"dz-placeholder",type:"button"},html:`\n                        <svg viewBox="0 0 24 24" width="24">\n                            <use xlink:href="${this.imagesFolder}/camera.svg#icon"></use>\n                        </svg>\n                    `})),this.dropzone.on("addedfile",(e=>{let t=this.checkMimeType(e.type);if(this.hiddenElement(this.dropzone.previewsContainer.querySelector(".dz-default.dz-message")),this.viewedElement(this.dropzone.previewsContainer.querySelector("button.dz-placeholder")),"video"===t&&this.createVideoThumbnail(e),"image"==t&&this.configFile.REVIEWS_MAX_IMAGE_SIZE<this.bytesToSize(e.size)){if(!e.edit)throw e.previewElement.querySelector("[data-dz-errormessage]").innerHTML=BX.message("error_image_size"),e.previewElement.classList.add("dz-error"),new Error(BX.message("error_image_size"))}else e.previewElement.classList.contains("dz-error")&&e.previewElement.classList.remove("dz-error");if("video"==t&&this.configFile.REVIEWS_MAX_COUNT_VIDEO<this.bytesToSize(e.size)){if(!e.edit)throw e.previewElement.querySelector("[data-dz-errormessage]").innerHTML=BX.message("error_video_size"),e.previewElement.classList.add("dz-error"),new Error(BX.message("error_video_size"))}else e.previewElement.classList.contains("dz-error")&&e.previewElement.classList.remove("dz-error");if(this.counterFile(e.type),this.configFile.REVIEWS_MAX_COUNT_VIDEO<this.counterVideo&&"video"==t)throw e.previewElement.querySelector("[data-dz-errormessage]").innerHTML=BX.message("error_video"),e.previewElement.classList.add("dz-error"),new Error(BX.message("error_video"));if(this.configFile.REVIEWS_MAX_COUNT_IMAGES<this.counterImage&&"image"==t)throw e.previewElement.querySelector("[data-dz-errormessage]").innerHTML=BX.message("error_image"),e.previewElement.classList.add("dz-error"),new Error(BX.message("error_image"));this.dropzone.previewsContainer.querySelectorAll(".dz-placeholder").forEach((e=>{"button"!=e.localName&&e.remove()}));for(let e=0;e<this.dropzone.options.maxFiles-this.dropzone.files.length;e++)this.dropzone.previewsContainer.appendChild(BX.create("div",{props:{className:"dz-placeholder"}}))})),this.dropzone.on("success",((e,t)=>{const i=JSON.parse(t);i.error&&(e.previewElement.querySelector("[data-dz-errormessage]").innerHTML=i.error.message,e.previewElement.classList.add("dz-error")),i.file.id&&(e.id=i.file.id,this.form.appendChild(this.hiddenInputs[i.file.id]=BX.create("input",{attrs:{type:"hidden",name:"MEDIA[]",value:i.file.id}})))})),this.dropzone.on("removedfile",(e=>{this.counterFileMinus(e.type),BX.remove(this.hiddenInputs[e.id]),BX.ajax.post(this.fileUploadUrl,{action:"removedfile",fileId:e.id}),this.dropzone.files.length||this.dropzone.previewsContainer.querySelector(".dz-image-preview")||(this.dropzone.previewsContainer.querySelectorAll(".dz-placeholder").forEach((e=>{e.classList.contains("d-block")?this.hiddenElement(e):e.remove()})),this.viewedElement(this.dropzone.previewsContainer.querySelector(".dz-default.dz-message")))})))},createVideoThumbnail:function(e){const t=e.previewElement.querySelector(".dz-image");if(!t)return void console.warn("imageContainer not found!");const i=e.previewElement.querySelector("img[data-dz-thumbnail]");if(!i)return void console.warn("img not found!");const s=document.createElement("video");s.setAttribute("data-dz-thumbnail","");const r=document.createElement("source");r.src=URL.createObjectURL(e),r.type=e.type,s.append(r),t.replaceChild(s,i)},hiddenElement:function(e){e&&(e.classList.contains("d-block")&&e.classList.remove("d-block"),e.classList.add("display-none-important"))},viewedElement:function(e){e&&(e.classList.contains("display-none-important")&&e.classList.remove("display-none-important"),e.classList.add("d-block"))},sendReview:function(e){if(e.preventDefault(),!this.form.reportValidity())return;let t=new FormData(this.form);"edit"==this.form.dataset.active&&SA_ReviewsList.editReviewsController(this.form),"add"==this.form.dataset.active&&(BX.ajax.runComponentAction("sotbit:rvw.reviews.add","addReviews",{mode:"class",data:new FormData(this.form),signedParameters:this.signedParameters}).then((e=>{BX.Sotbit.Reviews.hideElement(this.mainModal,{callback:()=>{BX.Sotbit.Reviews.hideOverlay()}}),BX.Sotbit.Reviews.unfixBodyScroll(),this.isModerate?t.get("ID_QUOTE")?this.showModalResult(BX.message("success_title_quote_moderate"),"success",BX.message("success_quote_text")):this.showModalResult(BX.message("success_title_moderate"),"success",BX.message("success_moderate_text")):t.get("ID_QUOTE")?this.showModalResult(BX.message("success_title_quote"),"success"):this.showModalResult(BX.message("success_title"),"success"),this.modRepeat>=0&&(this.canRepeat=!1),this.deleteFormField()}),(e=>{console.log(e),this.showModalResult(e.errors.map((e=>e.message)).join("\n"),"error")})),setTimeout((()=>{SA_Reviews.reloadList(this.getParams())}),"300"))},deleteFormField:function(e){this.form.querySelector('input[name="ID_QUOTE"]').value="",e||(e=document.querySelector("#review_add__modal")),e.querySelector(".review_add__title").innerHTML=BX.message("title_origin"),e.querySelector(".content__reviews__item__body--quote").classList.add("display-none-important"),this.form.reset(),this.form.dataset.active="add",this.mainModal.querySelectorAll('input[name="MEDIA[]"]').forEach((e=>e.remove())),this.counterImage=0,this.counterVideo=0,this.dropzone&&(this.dropzone.previewsContainer.querySelectorAll(".dz-preview").forEach((e=>e.remove())),this.dropzone.countFile=this.counterImage,this.hiddenElement(this.dropzone?.previewsContainer.querySelector("button.dz-placeholder")),this.viewedElement(this.dropzone?.previewsContainer.querySelector(".dz-default.dz-message"))),e.querySelectorAll(".dz-preview.dz-complete.dz-image-preview")&&e.querySelectorAll(".dz-preview.dz-complete.dz-image-preview").forEach((e=>e.remove())),e.querySelectorAll(".dz-file-preview.dz-preview.dz-error")&&e.querySelectorAll(".dz-file-preview.dz-preview.dz-error").forEach((e=>e.remove())),this.counterImage=0,this.counterVideo=0,idNode=e.querySelector('input[name="ID"]'),idNode&&idNode.remove()},showModalResult:function(e,t="",i=""){"success"==t&&(icon='<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M32.0007 5.33325C46.7282 5.33325 58.6673 17.2723 58.6673 31.9999C58.6673 46.7275 46.7282 58.6666 32.0007 58.6666C17.2731 58.6666 5.33398 46.7275 5.33398 31.9999C5.33398 17.2723 17.2731 5.33325 32.0007 5.33325ZM32.0007 9.33325C19.4822 9.33325 9.33398 19.4815 9.33398 31.9999C9.33398 44.5184 19.4822 54.6666 32.0007 54.6666C44.5191 54.6666 54.6673 44.5184 54.6673 31.9999C54.6673 19.4815 44.5191 9.33325 32.0007 9.33325ZM28.6673 35.8382L40.5864 23.919C41.3675 23.138 42.6338 23.138 43.4149 23.919C44.1249 24.6291 44.1895 25.7402 43.6085 26.5232L43.4149 26.7475L30.0815 40.0808C29.3715 40.7908 28.2604 40.8554 27.4774 40.2744L27.2531 40.0808L20.5864 33.4141C19.8054 32.6331 19.8054 31.3668 20.5864 30.5857C21.2965 29.8757 22.4076 29.8111 23.1905 30.3921L23.4149 30.5857L28.6673 35.8382L40.5864 23.919L28.6673 35.8382Z" fill="#18B131"/>\n                    </svg>',btns=""),"error"==t&&(icon='<svg width="73" height="72" viewBox="0 0 73 72" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                        <g clip-path="url(#clip0_6093_11246)">\n                                        <path d="M36.5 72C56.3823 72 72.5 55.8823 72.5 36C72.5 16.1177 56.3823 0 36.5 0C16.6177 0 0.5 16.1177 0.5 36C0.5 55.8823 16.6177 72 36.5 72Z" fill="#E31C1C"/>\n                                        <g clip-path="url(#clip1_6093_11246)">\n                                        <path d="M56 20L52 16L36 32L20 16L16 20L32 36L16 52L20 56L36 40L52 56L56 52L40 36L56 20Z" fill="white"/>\n                                        </g>\n                                        </g>\n                                        <defs>\n                                        <clipPath id="clip0_6093_11246">\n                                        <rect width="72" height="72" fill="white" transform="translate(0.5)"/>\n                                        </clipPath>\n                                        <clipPath id="clip1_6093_11246">\n                                        <rect width="40" height="40" fill="white" transform="translate(16 16)"/>\n                                        </clipPath>\n                                        </defs>\n                                    </svg>\n                ',btns=""),"selection"==t&&(icon='<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M31.9997 17.3333C33.1042 17.3333 33.9997 18.2287 33.9997 19.3333V35.9999C33.9997 37.1045 33.1042 37.9999 31.9997 37.9999C30.8951 37.9999 29.9997 37.1045 29.9997 35.9999V19.3333C29.9997 18.2287 30.8951 17.3333 31.9997 17.3333ZM31.9997 46.6607C33.4724 46.6607 34.6663 45.4668 34.6663 43.9941C34.6663 42.5213 33.4724 41.3274 31.9997 41.3274C30.5269 41.3274 29.333 42.5213 29.333 43.9941C29.333 45.4668 30.5269 46.6607 31.9997 46.6607ZM31.9997 5.33325C46.7273 5.33325 58.6663 17.2723 58.6663 31.9999C58.6663 46.7275 46.7273 58.6666 31.9997 58.6666C27.6842 58.6666 23.5139 57.6388 19.7673 55.7013L9.56512 58.5475C7.792 59.0426 5.95322 58.0066 5.45809 56.2335C5.29425 55.6468 5.29433 55.0263 5.4582 54.4401L8.30531 44.2459C6.36332 40.4959 5.33301 36.3206 5.33301 31.9999C5.33301 17.2723 17.2721 5.33325 31.9997 5.33325ZM31.9997 9.33325C19.4812 9.33325 9.33301 19.4815 9.33301 31.9999C9.33301 35.9189 10.3271 39.6889 12.1944 43.0331L12.5961 43.7526L9.6289 54.377L20.2598 51.4112L20.9786 51.8119C24.3198 53.6749 28.0855 54.6666 31.9997 54.6666C44.5181 54.6666 54.6663 44.5184 54.6663 31.9999C54.6663 19.4815 44.5181 9.33325 31.9997 9.33325Z" fill="#FF9935"/>\n                </svg>\n                ',btns=` \n                    <button class="btn-reviews btn-lite-reviews w-40 " value="Y">${BX.message("complains_yes")}</button>\n                    <button class="btn-reviews btn-reviews--main w-40 " value="N">${BX.message("complains_no")}</button>\n                `);const s=BX.create("DIV",{props:{className:"review_modal modal_result show",id:"modal_result"},html:`<div class="modal-content">\n                        <div class="review_add__modal_header">\n                           ${icon}\n                        </div>\n                        <div class="modal_result__content">\n                            <h5>${e}</h5>\n                            <div>${i}</div>\n                        </div>\n                            <div class="review_add__modal_footer d-flex">\n                                ${btns}\n                            </div>\n                        </div>`});document.body.appendChild(s),window.addEventListener("click",(e=>{e.target===s&&this.closeModalResult(),e.target===s.querySelector("button")&&(""==s.querySelector("button").value?this.closeModalResult():"selection"==t&&s.querySelectorAll("button").forEach((t=>{t==e.target&&"Y"==e.target.value&&(console.log(e),SA_ReviewsList.elementComplaintController())}))),"N"==e.target.value&&this.closeModalResult()}))},closeModalResult:function(){document.body.classList.remove("overflow-hidden"),document.getElementById("modal_result")?.remove(),BX.Sotbit.Reviews.hideOverlay()}};
//# sourceMappingURL=script.min.js.map
